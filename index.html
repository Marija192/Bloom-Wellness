<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloom - Flower Wellness Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#a8c5b4">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #9c88ff;
            --primary-light: #c7b9ff;
            --secondary: #ff9ff3;
            --accent: #54a0ff;
            --success: #1dd1a1;
            --warning: #feca57;
            --danger: #ff6b6b;
            --light: #f5f6fa;
            --dark: #2d3436;
            --gray: #8395a7;
            --text: #333;
            --bg: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --radius: 20px;
            --transition: all 0.3s ease;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* Login/Signup Screen */
        #auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .auth-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .auth-logo i {
            font-size: 48px;
            color: var(--primary);
        }

        .auth-logo h1 {
            font-size: 32px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .auth-subtitle {
            color: var(--gray);
            margin-bottom: 30px;
            font-size: 16px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 12px;
            background: #f8f9fa;
            padding: 4px;
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            color: var(--gray);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: var(--transition);
        }

        .auth-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(156, 136, 255, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .auth-btn:hover {
            background: #8c7ae6;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(156, 136, 255, 0.4);
        }

        .auth-switch {
            margin-top: 25px;
            color: var(--gray);
            font-size: 14px;
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        .success-message {
            color: var(--success);
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        /* Main App Container - Hidden by default */
        #main-app {
            display: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px 30px;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 32px;
            color: var(--primary);
        }

        .logo h1 {
            font-size: 28px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .user-name {
            font-weight: 600;
            color: var(--dark);
        }

        .logout-btn {
            background: transparent;
            border: none;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn:hover {
            background: #f8f9fa;
            color: var(--primary);
        }

        .stats-bar {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Top Row: Flower and Mood Side-by-Side */
        .top-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        /* Flower Area */
        .flower-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .flower-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .flower-title {
            font-size: 22px;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .flower-container {
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 20px;
        }

        /* Flower Drawing - Fixed Petal Positioning */
        .flower {
            position: relative;
            width: 220px;
            height: 220px;
        }

        .stem {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 120px;
            background: linear-gradient(to top, #2ecc71, #27ae60);
            border-radius: 4px;
            z-index: 1;
        }

        .leaves {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
        }

        .leaf {
            position: absolute;
            width: 40px;
            height: 20px;
            background: #27ae60;
            border-radius: 50%;
        }

        .leaf.left {
            left: -60px;
            transform: rotate(-45deg);
        }

        .leaf.right {
            right: -60px;
            transform: rotate(45deg);
        }

        .center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #f1c40f 30%, #e67e22 70%);
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.4);
            transition: var(--transition);
        }

        .center.glow {
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(241, 196, 15, 0.4); }
            to { box-shadow: 0 0 40px rgba(241, 196, 15, 0.8); }
        }

        /* Fixed Petal Positioning - ALL PETALS SAME COLOR FOR EACH FLOWER */
    

        .petal.bloom {
            opacity: 1;
            animation: bloomAnimation 1.5s ease-out forwards;
        }

        @keyframes bloomAnimation {
            0% { transform: scale(0.1) rotate(0deg); }
            100% { transform: scale(1) rotate(var(--rotation)); }
        }

        /* Petal positions for 5 petals - FIXED POSITIONING */
        .petal {
    position: absolute;
    width: 55px;
    height: 90px;
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    top: 8%;
    left: 40%;
    transform-origin: 50% 100%; /* pivot at bottom of petal */
    z-index: 5;
    background-color: #ff6b6b;
}

/* Place the 5 petals around the center */
.petal.pos-0 { --rotation: 0deg; z-index: 5; }
.petal.pos-1 { --rotation: 72deg; z-index: 4; }
.petal.pos-2 { --rotation: 144deg; z-index: 3; }
.petal.pos-3 { --rotation: 216deg; z-index: 2; }
.petal.pos-4 { --rotation: 288deg; z-index: 1; }

        /* Flower Info */
        .flower-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .flower-name {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
        }

        .flower-status {
            font-size: 16px;
            color: var(--gray);
        }

        .progress-container {
            width: 100%;
            margin-top: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--gray);
        }

        .progress-bar {
            height: 12px;
            background: #ecf0f1;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 6px;
            width: 0%;
            transition: width 1s ease;
        }

        /* Mood Section - Now next to Flower */
        .mood-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
        }

        .mood-title {
            font-size: 22px;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mood-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .mood-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 20px 10px;
            border-radius: 15px;
            transition: var(--transition);
            background: white;
            border: 2px solid transparent;
        }

        .mood-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .mood-option.selected {
            border-color: var(--primary);
            background: rgba(156, 136, 255, 0.05);
        }

        .mood-emoji {
            font-size: 36px;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f8f9fa;
            transition: var(--transition);
        }

        .mood-option.selected .mood-emoji {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .mood-label {
            font-size: 16px;
            color: var(--gray);
            font-weight: 500;
        }

        .mood-option.selected .mood-label {
            color: var(--primary);
            font-weight: 600;
        }

        .mood-trend {
            font-size: 15px;
            color: var(--gray);
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(156, 136, 255, 0.05);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        /* Tasks Section */
        .tasks-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .add-task-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .add-task-btn:hover {
            background: var(--accent);
            transform: rotate(90deg) scale(1.1);
        }

        .tasks-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .tasks-list::-webkit-scrollbar {
            width: 6px;
        }

        .tasks-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .tasks-list::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 3px;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 18px;
            margin-bottom: 15px;
            background: white;
            border-radius: 15px;
            transition: var(--transition);
            border-left: 6px solid transparent;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .task-item.mind { border-left-color: #54a0ff; }
        .task-item.body { border-left-color: #1dd1a1; }
        .task-item.emotional { border-left-color: #ff9ff3; }
        .task-item.productivity { border-left-color: #feca57; }

        .task-checkbox {
            width: 24px;
            height: 24px;
            margin-right: 18px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .task-text {
            font-size: 16px;
            color: var(--dark);
        }

        .task-text.completed {
            text-decoration: line-through;
            color: var(--gray);
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .task-category {
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            background: #e9ecef;
            color: var(--gray);
            font-weight: 500;
        }

        .task-date {
            font-size: 12px;
            color: var(--gray);
        }

        .task-actions {
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: var(--transition);
        }

        .task-item:hover .task-actions {
            opacity: 1;
        }

        .task-action-btn {
            background: transparent;
            border: none;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-action-btn:hover {
            background: #f8f9fa;
            color: var(--primary);
        }

        /* Wellness Row - Breathing, Journal, Garden side by side */
        .wellness-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 25px;
        }

        /* Breathing Section */
        .breathing-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .breathing-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            flex: 1;
        }

        .breathing-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
            transition: transform 1s ease, opacity 1s ease;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
        }

        .breathing-instruction {
            font-size: 16px;
            color: var(--dark);
            text-align: center;
            margin: 8px 0;
            min-height: 40px;
        }

        .breathing-timer {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            margin: 8px 0;
        }

        .breathing-controls {
            display: flex;
            gap: 12px;
            margin-top: auto;
        }

        .breath-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            background: var(--primary);
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            justify-content: center;
        }

        .breath-btn:hover {
            background: #6c5dc4;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(156, 136, 255, 0.3);
        }

        .breath-btn.secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        .breath-btn.secondary:hover {
            background: #c6c1d6;  
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(156, 136, 255, 0.3);
        }
        

        /* Journal Section */
        .journal-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .journal-textarea {
            width: 100%;
            height: 140px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 14px;
            resize: none;
            margin-bottom: 15px;
            transition: var(--transition);
            line-height: 1.6;
            flex: 1;
        }

        .journal-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(156, 136, 255, 0.1);
        }

        .journal-prompt {
            font-size: 14px;
            color: var(--primary);
            font-style: italic;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(156, 136, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .journal-controls {
            display: flex;
            gap: 12px;
            margin-top: auto;
        }

        .journal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            background: var(--primary);
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            justify-content: center;
        }

        .journal-btn:hover {
            background: #6c5dc4;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(156, 136, 255, 0.3);
        }

        .journal-btn.secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        .journal-btn.secondary:hover {
            background: #c6c1d6;  
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(156, 136, 255, 0.3);
        }

        /* Garden Section */
        .garden-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .garden-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 15px;
            flex: 1;
            align-content: start;
        }

        .garden-flower {
            aspect-ratio: 1;
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            padding: 8px;
            text-align: center;
            border: 2px solid transparent;
        }

        .garden-flower:hover {
            background: #f8f9fa;
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .flower-emoji {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .flower-day {
            font-size: 11px;
            color: var(--gray);
        }

        .garden-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }

        .garden-empty i {
            font-size: 40px;
            margin-bottom: 10px;
            color: #e9ecef;
        }

        /* Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 5px 20px rgba(156, 136, 255, 0.3);
        }

        .btn-primary:hover {
            background: #6c5dc4;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(156, 136, 255, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: #c6c1d6;
            transform: translateY(-3px);
        }
             .category-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .category-badge {
            padding: 8px 16px;
            border-radius: 20px;
            background: #e9ecef;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            font-weight: 500;
            font-size: 14px;
        }

        .category-badge:hover {
            transform: translateY(-2px);
        }

        .category-badge.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            animation: modalFade 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 22px;
            color: var(--dark);
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f8f9fa;
            color: var(--danger);
        }

        .flower-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .flower-details-header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
        }

        .flower-details-emoji {
            font-size: 60px;
            margin-bottom: 10px;
        }

        .flower-details-title {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .flower-details-date {
            color: var(--gray);
            font-size: 14px;
        }

        .flower-details-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .flower-stat {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .flower-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .flower-stat-label {
            font-size: 12px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .flower-details-notes {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
        }

        .flower-notes-title {
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .flower-notes-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--dark);
        }

        /* Form elements */
        .suggested-tasks {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .suggested-task {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            font-size: 14px;
        }

        .suggested-task:hover {
            background: #c6c1d6;
            transform: translateX(3px);
            border-left-color: var(--primary);
        }

        /* Animations */
        .streak-fire {
            animation: streakFire 1s infinite alternate;
        }

        @keyframes streakFire {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        @keyframes petalDrop {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 0; }
            100% { transform: translateY(0) rotate(360deg); opacity: 1; }
        }

        .petal-drop {
            position: fixed;
            font-size: 24px;
            z-index: 999;
            animation: petalDrop 1s ease-out forwards;
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .wellness-row {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .garden-section {
                grid-column: span 2;
            }
        }

        @media (max-width: 992px) {
            .top-row {
                grid-template-columns: 1fr;
            }
            
            .wellness-row {
                grid-template-columns: 1fr;
            }
            
            .garden-section {
                grid-column: span 1;
            }
            
            .stats-bar {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .stats-bar {
                width: 100%;
                justify-content: space-around;
            }
            
            .mood-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .garden-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .flower-container {
                height: 250px;
            }
            
            .flower {
                width: 200px;
                height: 200px;
            }
        }

        @media (max-width: 576px) {
            .mood-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .garden-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .breathing-circle {
                width: 120px;
                height: 120px;
            }
            
            .breathing-timer {
                font-size: 28px;
            }
            
            .mood-emoji {
                width: 60px;
                height: 60px;
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <!-- Login/Signup Screen -->
    <div id="auth-screen">
        <div class="auth-container">
            <div class="auth-logo">
                <i class="fas fa-spa"></i>
                <h1>Bloom Wellness</h1>
            </div>
            
            <p class="auth-subtitle">Track your wellness journey with beautiful flowers</p>
            
            <div class="auth-tabs">
                <button class="auth-tab active" id="login-tab">Login</button>
                <button class="auth-tab" id="signup-tab">Sign Up</button>
            </div>
            
            <!-- Login Form -->
            <div class="auth-form active" id="login-form">
                <div class="form-group">
                    <label class="form-label" for="login-username">Username</label>
                    <input type="text" class="form-input" id="login-username" placeholder="Enter your username">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="login-password">Password</label>
                    <input type="password" class="form-input" id="login-password" placeholder="Enter your password">
                </div>
                
                <div id="login-error" class="error-message"></div>
                
                <button class="auth-btn" id="login-btn">Login</button>
                
                <div class="auth-switch">
                    Don't have an account? <a id="switch-to-signup">Sign up here</a>
                </div>
            </div>
            
            <!-- Signup Form -->
            <div class="auth-form" id="signup-form">
                <div class="form-group">
                    <label class="form-label" for="signup-username">Username</label>
                    <input type="text" class="form-input" id="signup-username" placeholder="Choose a username">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="signup-email">Email (optional)</label>
                    <input type="email" class="form-input" id="signup-email" placeholder="Your email">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="signup-password">Password</label>
                    <input type="password" class="form-input" id="signup-password" placeholder="Create a password">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="signup-confirm">Confirm Password</label>
                    <input type="password" class="form-input" id="signup-confirm" placeholder="Confirm password">
                </div>
                
                <div id="signup-error" class="error-message"></div>
                <div id="signup-success" class="success-message"></div>
                
                <button class="auth-btn" id="signup-btn">Create Account</button>
                
                <div class="auth-switch">
                    Already have an account? <a id="switch-to-login">Login here</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App - Hidden until login -->
    <div id="main-app">
        <div class="container">
            <!-- Header -->
            <header>
                <div class="logo">
                    <i class="fas fa-spa"></i>
                    <h1>Bloom Wellness</h1>
                </div>
                
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-name" id="user-name">User</div>
                    <button class="logout-btn" id="logout-btn" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="day-count">1</div>
                        <div class="stat-label">Day</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="streak-count">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-petals">0</div>
                        <div class="stat-label">Petals</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completed-tasks">0</div>
                        <div class="stat-label">Tasks Done</div>
                    </div>
                </div>
            </header>

            <!-- Top Row: Flower and Mood Side-by-Side -->
            <div class="top-row">
                <!-- Flower Section -->
                <section class="flower-section">
                    <h2 class="flower-title"><i class="fas fa-seedling"></i> Today's Flower</h2>
                    <div class="flower-container">
                        <div class="flower">
                            <div class="stem"></div>
                            <div class="leaves">
                                <div class="leaf left"></div>
                                <div class="leaf right"></div>
                            </div>
                            <div class="center" id="flower-center"></div>
                            <!-- Petals will be added by JavaScript - ALL SAME COLOR -->
                        </div>
                    </div>
                    <div class="flower-info">
                        <div class="flower-name" id="flower-name">Seedling</div>
                        <div class="flower-status" id="flower-status">Complete 5 tasks to earn a petal</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Today's Progress</span>
                            <span id="progress-text">0/5 tasks</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </section>

                <!-- Mood Section - Now next to Flower -->
                <section class="mood-section">
                    <h2 class="mood-title"><i class="fas fa-smile-beam"></i> Today's Mood</h2>
                    <div class="mood-options" id="mood-options">
                        <!-- Mood options will be added by JavaScript -->
                    </div>
                    <div class="mood-trend" id="mood-trend">
                        Select your mood for today
                    </div>
                </section>
            </div>

            <!-- Tasks Section -->
            <section class="tasks-section">
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-tasks"></i> Today's Tasks</h2>
                    <button class="add-task-btn" id="add-task-btn" title="Add New Task">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <ul class="tasks-list" id="tasks-list">
                    <!-- Tasks will be added by JavaScript -->
                </ul>
            </section>

            <!-- Wellness Row: Breathing, Journal, Garden Side-by-Side -->
            <div class="wellness-row">
                <!-- Breathing Section -->
                <section class="breathing-section">
                    <h2 class="section-title"><i class="fas fa-wind"></i> Breathing Exercise</h2>
                    <div class="breathing-container">
                        <div class="breathing-circle" id="breathing-circle">
                            <span id="breath-text">Ready</span>
                        </div>
                        <div class="breathing-instruction" id="breathing-instruction">
                            Ready to begin? Click Start
                        </div>
                        <div class="breathing-timer" id="breathing-timer">--</div>
                        <div class="breathing-controls">
                            <button class="breath-btn" id="start-breathing">
                                <i class="fas fa-play"></i> Start
                            </button>
                            <button class="breath-btn secondary" id="reset-breathing">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Journal Section -->
                <section class="journal-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-book-open"></i> Daily Journal</h2>
                    </div>
                    <div class="journal-prompt" id="journal-prompt">
                        What's one small win today?
                    </div>
                    <textarea class="journal-textarea" id="journal-text" 
                              placeholder="Write your thoughts here..."></textarea>
                    <div class="journal-controls">
                        <button class="journal-btn" id="save-journal-btn">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button class="journal-btn secondary" id="view-journal-btn">
                            <i class="fas fa-history"></i> History
                        </button>
                    </div>
                </section>

                <!-- Garden Section -->
                <section class="garden-section">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-leaf"></i> Flower Garden</h2>
                    </div>
                    <div class="garden-grid" id="garden-grid">
                        <!-- Garden flowers will be added by JavaScript -->
                    </div>
                </section>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-secondary" id="new-day-btn">
                    <i class="fas fa-calendar-plus"></i> Start New Day
                </button>
                <button class="btn btn-primary" id="complete-day-btn">
                    <i class="fas fa-check-circle"></i> Complete Day
                </button>
            </div>
        </div>

        <!-- Add Task Modal -->
        <div class="modal" id="add-task-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Add New Task</h3>
                    <button class="modal-close" id="close-task-modal">&times;</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Task Description</label>
                    <input type="text" class="form-input" id="task-input" 
                           placeholder="What would you like to accomplish today?" autofocus>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <div class="category-badges" id="category-badges">
                        <!-- Categories will be added by JavaScript -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Suggested Tasks</label>
                    <div class="suggested-tasks" id="suggested-tasks">
                        <!-- Suggested tasks will be added by JavaScript -->
                    </div>
                </div>
                <button class="btn btn-primary" id="save-task-btn" style="width: 100%;">
                    Add Task
                </button>
            </div>
        </div>

        <!-- Journal History Modal -->
        <div class="modal" id="journal-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Journal History</h3>
                    <button class="modal-close" id="close-journal-modal">&times;</button>
                </div>
                <div id="journal-history">
                    <!-- Journal history will be added by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Flower Details Modal -->
        <div class="modal" id="flower-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Flower Details</h3>
                    <button class="modal-close" id="close-flower-modal">&times;</button>
                </div>
                <div class="flower-details" id="flower-details-content">
                    <!-- Flower details will be added by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // User Management
        class UserManager {
            constructor() {
                this.currentUser = null;
                this.usersKey = 'bloom-wellness-users';
                this.currentUserKey = 'bloom-wellness-current-user';
                this.users = this.loadUsers();
            }

            loadUsers() {
                const usersData = localStorage.getItem(this.usersKey);
                return usersData ? JSON.parse(usersData) : {};
            }

            saveUsers() {
                localStorage.setItem(this.usersKey, JSON.stringify(this.users));
            }

            userExists(username) {
                return this.users.hasOwnProperty(username);
            }

            createUser(username, password, email = '') {
                if (this.userExists(username)) {
                    return { success: false, message: 'Username already exists' };
                }

                const newUser = {
                    username: username,
                    email: email,
                    password: password, // In a real app, hash this!
                    createdAt: new Date().toISOString(),
                    appState: this.createDefaultAppState()
                };

                this.users[username] = newUser;
                this.saveUsers();
                
                return { success: true, message: 'Account created successfully!' };
            }

            login(username, password) {
                if (!this.userExists(username)) {
                    return { success: false, message: 'User not found' };
                }

                const user = this.users[username];
                
                if (user.password !== password) {
                    return { success: false, message: 'Incorrect password' };
                }

                this.currentUser = user;
                localStorage.setItem(this.currentUserKey, username);
                
                return { success: true, message: 'Login successful!', user: user };
            }

            logout() {
                this.currentUser = null;
                localStorage.removeItem(this.currentUserKey);
            }

            getCurrentUser() {
                if (!this.currentUser) {
                    const username = localStorage.getItem(this.currentUserKey);
                    if (username && this.userExists(username)) {
                        this.currentUser = this.users[username];
                    }
                }
                return this.currentUser;
            }

            updateUserAppState(appState) {
                if (!this.currentUser) return;
                
                this.currentUser.appState = appState;
                this.users[this.currentUser.username] = this.currentUser;
                this.saveUsers();
            }

            createDefaultAppState() {
                return {
                    currentDay: 1,
                    streak: 0,
                    completedTasksToday: 0,
                    totalTasksNeeded: 5,
                    currentFlowerPetals: 0,
                    totalPetals: 0,
                    currentMood: null,
                    todayJournal: '',
                    journalHistory: [],
                    tasks: [],
                    garden: [],
                    currentFlowerId: 1,
                    flowers: [],
                    lastCompletedDate: null
                };
            }
        }

        // Initialize User Manager
        const userManager = new UserManager();

        // Mood Options
        const moodOptions = [
            { emoji: '', label: 'Happy', color: '#1dd1a1' },
            { emoji: '', label: 'Calm', color: '#54a0ff' },
            { emoji: '', label: 'Neutral', color: '#8395a7' },
            { emoji: '', label: 'Sad', color: '#5f27cd' },
            { emoji: '', label: 'Tired', color: '#ff9f43' },
            { emoji: '', label: 'Stressed', color: '#ee5a24' }
        ];

        // Task Categories
        const taskCategories = [
            { id: 'mind', name: 'Mind', color: '#54a0ff', icon: '' },
            { id: 'body', name: 'Body', color: '#1dd1a1', icon: '' },
            { id: 'emotional', name: 'Emotional', color: '#ff9ff3', icon: '' },
            { id: 'productivity', name: 'Productivity', color: '#feca57', icon: '' }
        ];

        // Suggested Tasks
        const suggestedTasks = [
            'Meditate for 10 minutes',
            'Drink 8 glasses of water',
            'Exercise for 30 minutes',
            'Read for 20 minutes',
            'Practice gratitude journaling',
            'Take a mindful walk',
            'Do breathing exercises',
            'Stretch for 10 minutes',
            'Connect with a friend',
            'Spend time in nature',
            'Practice yoga',
            'Listen to calming music',
            'Take a digital detox hour',
            'Prepare a healthy meal',
            'Get 8 hours of sleep'
        ];

        // Journal Prompts
        const journalPrompts = [
            "What felt good today?",
            "What's one small win?",
            "What are you grateful for today?",
            "What would make tomorrow better?",
            "How did you take care of yourself today?",
            "What made you smile today?",
            "What lesson did today teach you?",
            "What are you looking forward to?",
            "How did you show kindness today?",
            "What helped you feel peaceful today?"
        ];

        // Flower Colors for DIFFERENT FLOWERS (each flower gets one color)
        const flowerColors = [
            '#ff6b6b', '#ff9a8b', '#ffccac', '#fff5ba',
            '#a8e6cf', '#95e1d3', '#6dd5ed', '#4a90e2',
            '#c5a3e0', '#dda9e8', '#ffb6c1', '#ffc1cc'
        ];

        // Flower Emojis (based on number of petals)
        const flowerEmojis = ['', '', '', '', '', ''];

        // Breathing Exercise
        let breathingTimer = null;
        let breathingPhase = 'ready'; // ready, inhale, hold, exhale
        let breathingTimeLeft = 0;
        const breathingPattern = {
            inhale: 4,
            hold: 7,
            exhale: 8
        };

        // App State - Will be loaded from user data
        let appState = null;

        // DOM Elements
        const authScreen = document.getElementById('auth-screen');
        const mainApp = document.getElementById('main-app');
        
        // Login/Signup Elements
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const loginError = document.getElementById('login-error');
        const signupUsername = document.getElementById('signup-username');
        const signupEmail = document.getElementById('signup-email');
        const signupPassword = document.getElementById('signup-password');
        const signupConfirm = document.getElementById('signup-confirm');
        const signupBtn = document.getElementById('signup-btn');
        const signupError = document.getElementById('signup-error');
        const signupSuccess = document.getElementById('signup-success');
        const switchToSignup = document.getElementById('switch-to-signup');
        const switchToLogin = document.getElementById('switch-to-login');
        
        // User Info Elements
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const logoutBtn = document.getElementById('logout-btn');

        // App Elements
        const dayCountEl = document.getElementById('day-count');
        const streakCountEl = document.getElementById('streak-count');
        const totalPetalsEl = document.getElementById('total-petals');
        const completedTasksEl = document.getElementById('completed-tasks');
        const tasksList = document.getElementById('tasks-list');
        const addTaskBtn = document.getElementById('add-task-btn');
        const addTaskModal = document.getElementById('add-task-modal');
        const closeTaskModal = document.getElementById('close-task-modal');
        const taskInput = document.getElementById('task-input');
        const saveTaskBtn = document.getElementById('save-task-btn');
        const categoryBadges = document.getElementById('category-badges');
        const suggestedTasksContainer = document.getElementById('suggested-tasks');
        const moodOptionsContainer = document.getElementById('mood-options');
        const journalPrompt = document.getElementById('journal-prompt');
        const journalText = document.getElementById('journal-text');
        const saveJournalBtn = document.getElementById('save-journal-btn');
        const viewJournalBtn = document.getElementById('view-journal-btn');
        const gardenGrid = document.getElementById('garden-grid');
        const newDayBtn = document.getElementById('new-day-btn');
        const completeDayBtn = document.getElementById('complete-day-btn');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const flowerCenter = document.getElementById('flower-center');
        const flowerName = document.getElementById('flower-name');
        const flowerStatus = document.getElementById('flower-status');
        const moodTrend = document.getElementById('mood-trend');
        const journalModal = document.getElementById('journal-modal');
        const closeJournalModal = document.getElementById('close-journal-modal');
        const journalHistory = document.getElementById('journal-history');
        const flowerModal = document.getElementById('flower-modal');
        const closeFlowerModal = document.getElementById('close-flower-modal');
        const flowerDetailsContent = document.getElementById('flower-details-content');
        
        // Breathing elements
        const breathingCircle = document.getElementById('breathing-circle');
        const breathingInstruction = document.getElementById('breathing-instruction');
        const breathingTimerEl = document.getElementById('breathing-timer');
        const startBreathingBtn = document.getElementById('start-breathing');
        const resetBreathingBtn = document.getElementById('reset-breathing');

        // Initialize the app
        function initApp() {
            // Check if user is already logged in
            const currentUser = userManager.getCurrentUser();
            
            if (currentUser) {
                // User is logged in, load their app
                appState = currentUser.appState;
                showMainApp(currentUser);
            } else {
                // Show login screen
                showAuthScreen();
            }
            
            // Initialize breathing exercise
            initBreathingExercise();
        }

        // Show authentication screen
        function showAuthScreen() {
            authScreen.style.display = 'flex';
            mainApp.style.display = 'none';
        }

        // Show main app
        function showMainApp(user) {
            authScreen.style.display = 'none';
            mainApp.style.display = 'block';
            
            // Set user info
            userName.textContent = user.username;
            userAvatar.textContent = user.username.charAt(0).toUpperCase();
            userAvatar.style.backgroundColor = getAvatarColor(user.username);
            
            // Initialize app components
            renderTasks();
            renderMoodOptions();
            renderCategories();
            renderSuggestedTasks();
            renderGarden();
            renderFlowerPetals();
            updateUI();
            
            // Set random journal prompt
            updateJournalPrompt();
        }

        // Get a consistent color for user avatar based on username
        function getAvatarColor(username) {
            const colors = [
                '#ff6b6b', '#ff9a8b', '#ffccac', 
                '#a8e6cf', '#95e1d3', '#6dd5ed', 
                '#4a90e2', '#c5a3e0', '#dda9e8'
            ];
            let hash = 0;
            for (let i = 0; i < username.length; i++) {
                hash = username.charCodeAt(i) + ((hash << 5) - hash);
            }
            return colors[Math.abs(hash) % colors.length];
        }

        // Save app state to user's data
        function saveState() {
            if (appState && userManager.currentUser) {
                userManager.updateUserAppState(appState);
            }
        }

        // Create a new flower - each flower gets ONE consistent color
        function createNewFlower() {
            const newFlower = {
                id: appState.currentFlowerId++,
                dayStarted: appState.currentDay,
                petals: 0,
                // Each flower gets ONE unique color - all petals will be this color
                color: flowerColors[Math.floor(Math.random() * flowerColors.length)],
                completed: false,
                daysToComplete: [],
                tasksCompleted: []
            };
            appState.flowers.push(newFlower);
            
            return newFlower;
        }

        // Get current flower
        function getCurrentFlower() {
            return appState.flowers.find(flower => !flower.completed) || createNewFlower();
        }

        // Check streak based on last completed date
        function checkStreak() {
            if (!appState.lastCompletedDate) return;
            
            const lastDate = new Date(appState.lastCompletedDate);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            // Reset time to midnight for comparison
            lastDate.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            yesterday.setHours(0, 0, 0, 0);
            
            if (lastDate.getTime() === yesterday.getTime()) {
                // Consecutive day - streak continues
                appState.streak++;
            } else if (lastDate.getTime() < yesterday.getTime()) {
                // Missed a day - reset streak
                appState.streak = 0;
            }
        }

        // Render tasks
        function renderTasks() {
            tasksList.innerHTML = '';
            
            // Filter tasks for today
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = appState.tasks.filter(task => task.date === today);
            
            if (todayTasks.length === 0) {
                tasksList.innerHTML = `
                    <li class="task-empty" style="text-align: center; color: var(--gray); padding: 40px;">
                        <i class="fas fa-tasks" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>No tasks for today. Add your first task!</p>
                    </li>
                `;
                return;
            }
            
            // Count completed tasks for today
            appState.completedTasksToday = todayTasks.filter(task => task.completed).length;
            
            todayTasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `task-item ${task.category}`;
                
                const category = taskCategories.find(cat => cat.id === task.category);
                
                li.innerHTML = `
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} data-id="${task.id}">
                    <div class="task-content">
                        <div class="task-text ${task.completed ? 'completed' : ''}">${task.text}</div>
                        <div class="task-meta">
                            <span class="task-category">${category ? category.icon + ' ' + category.name : task.category}</span>
                            <span class="task-date">Today</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="task-action-btn edit-task" data-id="${task.id}" title="Edit Task">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="task-action-btn delete-task" data-id="${task.id}" title="Delete Task">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                tasksList.appendChild(li);
            });
        }

        // Render mood options
        function renderMoodOptions() {
            moodOptionsContainer.innerHTML = '';
            
            moodOptions.forEach(mood => {
                const div = document.createElement('div');
                div.className = `mood-option ${appState.currentMood === mood.label ? 'selected' : ''}`;
                div.setAttribute('data-mood', mood.label);
                div.innerHTML = `
                    <div class="mood-emoji">${mood.emoji}</div>
                    <div class="mood-label">${mood.label}</div>
                `;
                moodOptionsContainer.appendChild(div);
            });
        }

        // Render categories
        function renderCategories() {
            categoryBadges.innerHTML = '';
            
            taskCategories.forEach(category => {
                const span = document.createElement('span');
                span.className = 'category-badge';
                span.setAttribute('data-category', category.id);
                span.innerHTML = `${category.icon} ${category.name}`;
                categoryBadges.appendChild(span);
            });
            
            // Select first category by default
            if (document.querySelector('.category-badge')) {
                document.querySelector('.category-badge').classList.add('selected');
            }
        }

        // Render suggested tasks
        function renderSuggestedTasks() {
            suggestedTasksContainer.innerHTML = '';
            
            // Show random suggested tasks
            const shuffled = [...suggestedTasks].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 5);
            
            selected.forEach(task => {
                const div = document.createElement('div');
                div.className = 'suggested-task';
                div.textContent = task;
                suggestedTasksContainer.appendChild(div);
            });
        }

        // Render garden
        function renderGarden() {
            gardenGrid.innerHTML = '';
            
            // Get completed flowers
            const completedFlowers = appState.flowers.filter(flower => flower.completed);
            
            if (completedFlowers.length === 0) {
                gardenGrid.innerHTML = `
                    <div class="garden-empty">
                        <i class="fas fa-seedling"></i>
                        <p>Your garden is empty</p>
                        <p style="font-size: 12px; margin-top: 5px;">Complete flowers to grow your garden!</p>
                    </div>
                `;
                return;
            }
            
            // Show only the most recent 12 flowers
            const recentFlowers = completedFlowers.slice(-12).reverse();
            
            recentFlowers.forEach(flower => {
                const div = document.createElement('div');
                div.className = 'garden-flower';
                div.innerHTML = `
                    <div class="flower-emoji">${flowerEmojis[flower.petals] || ''}</div>
                    <div class="flower-day">Day ${flower.dayStarted}</div>
                `;
                div.style.backgroundColor = flower.color + '20';
                div.setAttribute('data-flower-id', flower.id);
                gardenGrid.appendChild(div);
            });
        }

        // Render flower petals - ALL PETALS SAME COLOR FOR EACH FLOWER
        function renderFlowerPetals() {
            const flower = document.querySelector('.flower');
            const existingPetals = document.querySelectorAll('.petal');
            existingPetals.forEach(petal => petal.remove());
            
            const currentFlower = getCurrentFlower();
            
            // Show petals for current flower - ALL with the SAME COLOR
            for (let i = 0; i < currentFlower.petals; i++) {
                const petal = document.createElement('div');
                petal.className = `petal bloom pos-${i}`;
                petal.style.backgroundColor = currentFlower.color;
                
                flower.appendChild(petal);
            }
        }

        // Update UI
        function updateUI() {
            const currentFlower = getCurrentFlower();
            
            // Update header stats
            dayCountEl.textContent = appState.currentDay;
            streakCountEl.textContent = appState.streak;
            totalPetalsEl.textContent = appState.totalPetals;
            completedTasksEl.textContent = appState.completedTasksToday;
            
            // Update progress bar
            const progressPercentage = (appState.completedTasksToday / appState.totalTasksNeeded) * 100;
            progressFill.style.width = `${progressPercentage}%`;
            progressText.textContent = `${appState.completedTasksToday}/${appState.totalTasksNeeded} tasks`;
            
            // Update flower status
            if (currentFlower.petals === 5) {
                flowerStatus.textContent = `Flower Complete! ${currentFlower.petals}/5 petals`;
            } else {
                flowerStatus.textContent = `Flower ${currentFlower.id}: ${currentFlower.petals}/5 petals`;
            }
            
            // Update flower name based on petals
            if (currentFlower.petals === 0) {
                flowerName.textContent = "Seedling";
                flowerName.style.color = '#27ae60';
            } else if (currentFlower.petals < 5) {
                flowerName.textContent = "Growing Flower";
                flowerName.style.color = '#3498db';
            } else {
                flowerName.textContent = "Full Bloom!";
                flowerName.style.color = '#9c88ff';
            }
            
            // Update flower center glow for streak
            if (appState.streak >= 3) {
                flowerCenter.classList.add('glow');
            } else {
                flowerCenter.classList.remove('glow');
            }
            
            // Update complete button state
            completeDayBtn.disabled = appState.completedTasksToday < appState.totalTasksNeeded;
            completeDayBtn.style.opacity = appState.completedTasksToday < appState.totalTasksNeeded ? '0.6' : '1';
            completeDayBtn.innerHTML = appState.completedTasksToday >= appState.totalTasksNeeded ? 
                '<i class="fas fa-check-circle"></i> Complete Day & Earn Petal' : 
                '<i class="fas fa-check-circle"></i> Complete Day';
            
            // Re-render petals
            renderFlowerPetals();
            
            // Save state
            saveState();
        }

        // Add a petal to current flower
        function addPetalToFlower() {
            const currentFlower = getCurrentFlower();
            
            if (currentFlower.petals < 5) {
                currentFlower.petals++;
                appState.totalPetals++;
                
                // Add today's data to flower
                currentFlower.daysToComplete.push(appState.currentDay);
                currentFlower.tasksCompleted.push(appState.completedTasksToday);
                
                // If flower is now complete (all 5 petals), move to garden
                if (currentFlower.petals === 5) {
                    currentFlower.completed = true;
                    currentFlower.dayCompleted = appState.currentDay;
                    currentFlower.mood = appState.currentMood || 'Not recorded';
                    appState.garden.push(currentFlower);
                    
                    // Create new flower for next day - will have different color
                    createNewFlower();
                    
                    // Show celebration for completed flower
                    showFlowerCompletedCelebration(currentFlower);
                }
                
                return true;
            }
            return false;
        }

        // Create petal drop animation
        function createPetalDropAnimation() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const petal = document.createElement('div');
                    petal.className = 'petal-drop';
                    petal.innerHTML = '';
                    petal.style.left = `${Math.random() * 100}vw`;
                    petal.style.color = getCurrentFlower().color;
                    petal.style.fontSize = `${Math.random() * 20 + 20}px`;
                    
                    document.body.appendChild(petal);
                    
                    // Remove after animation
                    setTimeout(() => {
                        petal.remove();
                    }, 1000);
                }, i * 200);
            }
        }

        // Show flower completed celebration
        function showFlowerCompletedCelebration(flower) {
            const message = `
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 64px; margin-bottom: 20px;"></div>
                    <h3 style="margin-bottom: 15px; color: var(--primary);">Flower Complete!</h3>
                    <p style="margin-bottom: 20px; color: var(--gray);">
                        Your flower has fully bloomed and been added to your garden!
                    </p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin: 15px 0;">
                        <p><strong>Flower ${flower.id}</strong>  Started on Day ${flower.dayStarted}</p>
                        <p>Completed in ${flower.daysToComplete.length} days</p>
                    </div>
                    <p style="font-size: 14px; color: var(--gray);">
                        A new seedling has been planted for your next flower!
                    </p>
                </div>
            `;
            
            // Temporarily show in flower status
            flowerStatus.textContent = " Flower Complete! Added to Garden!";
            flowerStatus.style.color = '#9c88ff';
            flowerStatus.style.fontWeight = '600';
            
            setTimeout(() => {
                const currentFlower = getCurrentFlower();
                flowerStatus.textContent = `Flower ${currentFlower.id}: ${currentFlower.petals}/5 petals`;
                flowerStatus.style.color = '';
                flowerStatus.style.fontWeight = '';
            }, 3000);
            
            // Trigger petal drop animation
            createPetalDropAnimation();
        }

        // Show petal earned celebration
        function showPetalCelebration() {
            const messages = [
                " Amazing! You earned a petal!",
                " Your flower is growing!",
                " Well done! Keep blooming!",
                " Another beautiful petal!",
                " You're doing great!"
            ];
            
            flowerStatus.textContent = messages[Math.floor(Math.random() * messages.length)];
            flowerStatus.style.color = '#9c88ff';
            flowerStatus.style.fontWeight = '600';
            
            // Trigger petal drop animation
            createPetalDropAnimation();
            
            // Reset after 3 seconds
            setTimeout(() => {
                const currentFlower = getCurrentFlower();
                flowerStatus.textContent = `Flower ${currentFlower.id}: ${currentFlower.petals}/5 petals`;
                flowerStatus.style.color = '';
                flowerStatus.style.fontWeight = '';
            }, 3000);
        }

        // Update journal prompt
        function updateJournalPrompt() {
            const randomPrompt = journalPrompts[Math.floor(Math.random() * journalPrompts.length)];
            journalPrompt.textContent = randomPrompt;
        }

        // Initialize breathing exercise
        function initBreathingExercise() {
            breathingPhase = 'ready';
            breathingTimeLeft = 0;
            updateBreathingUI();
        }

        // Start breathing exercise
        function startBreathingExercise() {
            if (breathingTimer) {
                clearInterval(breathingTimer);
            }
            
            breathingPhase = 'inhale';
            breathingTimeLeft = breathingPattern.inhale;
            updateBreathingUI();
            
            breathingTimer = setInterval(() => {
                breathingTimeLeft--;
                
                if (breathingTimeLeft <= 0) {
                    switch (breathingPhase) {
                        case 'inhale':
                            breathingPhase = 'hold';
                            breathingTimeLeft = breathingPattern.hold;
                            break;
                        case 'hold':
                            breathingPhase = 'exhale';
                            breathingTimeLeft = breathingPattern.exhale;
                            break;
                        case 'exhale':
                            // Cycle complete, start over
                            breathingPhase = 'inhale';
                            breathingTimeLeft = breathingPattern.inhale;
                            break;
                    }
                }
                
                updateBreathingUI();
            }, 1000);
        }

        // Update breathing UI
        function updateBreathingUI() {
            let instruction = '';
            let circleColor = '';
            let circleScale = 1;
            let breathText = 'Ready';
            
            switch (breathingPhase) {
                case 'ready':
                    instruction = 'Ready to begin? Click Start';
                    circleColor = '#74b9ff';
                    breathingTimerEl.textContent = '--';
                    breathText = 'Ready';
                    break;
                case 'inhale':
                    instruction = 'Breathe In... Slowly (4 sec)';
                    circleColor = '#00b894';
                    circleScale = 1.2 + (breathingTimeLeft / breathingPattern.inhale) * 0.3;
                    breathingTimerEl.textContent = breathingTimeLeft;
                    breathText = 'Inhale';
                    break;
                case 'hold':
                    instruction = 'Hold... (7 sec)';
                    circleColor = '#0984e3';
                    circleScale = 1.5;
                    breathingTimerEl.textContent = breathingTimeLeft;
                    breathText = 'Hold';
                    break;
                case 'exhale':
                    instruction = 'Breathe Out... Slowly (8 sec)';
                    circleColor = '#e17055';
                    circleScale = 1.2 - (breathingTimeLeft / breathingPattern.exhale) * 0.3;
                    breathingTimerEl.textContent = breathingTimeLeft;
                    breathText = 'Exhale';
                    break;
            }
            
            breathingInstruction.textContent = instruction;
            breathingCircle.style.background = circleColor;
            breathingCircle.style.transform = `scale(${circleScale})`;
            breathingCircle.style.transition = 'transform 1s ease, background 0.5s ease';
            document.getElementById('breath-text').textContent = breathText;
        }

        // Reset breathing exercise
        function resetBreathingExercise() {
            if (breathingTimer) {
                clearInterval(breathingTimer);
                breathingTimer = null;
            }
            initBreathingExercise();
        }

        // Save journal entry
        function saveJournalEntry() {
            const entryText = journalText.value.trim();
            if (!entryText) {
                alert('Please write something in your journal before saving.');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const entry = {
                date: today,
                text: entryText,
                mood: appState.currentMood || 'Not recorded',
                day: appState.currentDay,
                flowerId: getCurrentFlower().id
            };
            
            // Save today's journal
            appState.todayJournal = entryText;
            
            // Add to history
            appState.journalHistory.unshift(entry);
            
            // Keep only last 30 entries
            if (appState.journalHistory.length > 30) {
                appState.journalHistory.pop();
            }
            
            // Clear textarea
            journalText.value = '';
            
            // Show confirmation
            showJournalSavedConfirmation();
            
            // Update UI
            saveState();
        }

        // Show journal saved confirmation
        function showJournalSavedConfirmation() {
            const originalText = saveJournalBtn.innerHTML;
            saveJournalBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
            saveJournalBtn.style.background = '#1dd1a1';
            
            setTimeout(() => {
                saveJournalBtn.innerHTML = originalText;
                saveJournalBtn.style.background = '';
            }, 2000);
        }

        // Render journal history modal
        function renderJournalHistory() {
            journalHistory.innerHTML = '';
            
            if (appState.journalHistory.length === 0) {
                journalHistory.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-book-open" style="font-size: 48px; margin-bottom: 20px; opacity: 0.3;"></i>
                        <p>No journal entries yet</p>
                    </div>
                `;
                return;
            }
            
            appState.journalHistory.forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'journal-entry';
                entryDiv.style.marginBottom = '15px';
                entryDiv.innerHTML = `
                    <div class="entry-date">
                        <strong>Day ${entry.day}</strong>  ${entry.date}  
                        <span style="color: ${moodOptions.find(m => m.label === entry.mood)?.color || '#8395a7'}">
                            ${entry.mood}
                        </span>
                    </div>
                    <div class="entry-text">${entry.text}</div>
                `;
                journalHistory.appendChild(entryDiv);
            });
        }

        // Show flower details modal
        function showFlowerDetails(flowerId) {
            const flower = appState.flowers.find(f => f.id === flowerId);
            if (!flower) return;
            
            // Get journal entries for this flower
            const flowerJournals = appState.journalHistory.filter(entry => entry.flowerId === flowerId);
            
            flowerDetailsContent.innerHTML = `
                <div class="flower-details-header">
                    <div class="flower-details-emoji">${flowerEmojis[flower.petals] || ''}</div>
                    <h3 class="flower-details-title">Flower ${flower.id}</h3>
                    <div class="flower-details-date">
                        ${flower.completed ? 
                            `Completed on Day ${flower.dayCompleted}` : 
                            `Started on Day ${flower.dayStarted}`}
                    </div>
                </div>
                
                <div class="flower-details-stats">
                    <div class="flower-stat">
                        <div class="flower-stat-value">${flower.petals}</div>
                        <div class="flower-stat-label">Petals</div>
                    </div>
                    <div class="flower-stat">
                        <div class="flower-stat-value">${flower.daysToComplete?.length || 0}</div>
                        <div class="flower-stat-label">Days</div>
                    </div>
                    <div class="flower-stat">
                        <div class="flower-stat-value">${flower.tasksCompleted?.reduce((a, b) => a + b, 0) || 0}</div>
                        <div class="flower-stat-label">Tasks</div>
                    </div>
                    <div class="flower-stat">
                        <div class="flower-stat-value">${flower.mood || 'N/A'}</div>
                        <div class="flower-stat-label">Mood</div>
                    </div>
                </div>
                
                <div class="flower-details-notes">
                    <h4 class="flower-notes-title"><i class="fas fa-clipboard-list"></i> Flower Progress</h4>
                    <div class="flower-notes-text">
                        ${flower.daysToComplete?.map((day, index) => 
                            `Day ${day}: Earned petal ${index + 1} (${flower.tasksCompleted?.[index] || 0} tasks completed)`
                        ).join('<br>') || 'No progress recorded yet.'}
                    </div>
                </div>
                
                ${flowerJournals.length > 0 ? `
                <div class="flower-details-notes">
                    <h4 class="flower-notes-title"><i class="fas fa-book"></i> Journal Entries</h4>
                    <div class="flower-notes-text">
                        ${flowerJournals.map(entry => 
                            `<strong>Day ${entry.day}:</strong> ${entry.text.substring(0, 100)}${entry.text.length > 100 ? '...' : ''}<br>`
                        ).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div style="text-align: center; margin-top: 20px;">
                    <div style="display: inline-block; width: 50px; height: 50px; border-radius: 50%; background: ${flower.color};"></div>
                    <p style="font-size: 12px; color: var(--gray); margin-top: 10px;">Flower Color (All 5 petals were this color)</p>
                </div>
            `;
            
            flowerModal.classList.add('active');
        }

        // Complete the day
        function completeDay() {
            if (appState.completedTasksToday < appState.totalTasksNeeded) {
                alert(`You need to complete ${appState.totalTasksNeeded} tasks to earn a petal. You have completed ${appState.completedTasksToday} tasks.`);
                return;
            }
            
            // Check if mood is selected
            if (!appState.currentMood) {
                if (!confirm("You haven't selected a mood for today. Continue without mood?")) {
                    return;
                }
            }
            
            // Add petal to current flower
            const petalAdded = addPetalToFlower();
            
            if (petalAdded) {
                // Show celebration
                showPetalCelebration();
                
                // Update streak
                const today = new Date();
                appState.lastCompletedDate = today.toISOString();
                
                // Check if consecutive day
                if (appState.streak === 0) {
                    appState.streak = 1;
                } else if (appState.lastCompletedDate) {
                    const lastDate = new Date(appState.lastCompletedDate);
                    const today = new Date();
                    const diffTime = Math.abs(today - lastDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) {
                        appState.streak++;
                    } else if (diffDays > 1) {
                        appState.streak = 1;
                    }
                }
            }
            
            // Reset for next day
            appState.currentDay++;
            appState.completedTasksToday = 0;
            
            // Clear today's tasks
            const todayStr = new Date().toISOString().split('T')[0];
            appState.tasks = appState.tasks.filter(task => task.date !== todayStr);
            
            // Update journal prompt
            updateJournalPrompt();
            
            // Update UI
            renderTasks();
            renderGarden();
            updateUI();
        }

        // Login/Signup Event Listeners
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            signupTab.classList.remove('active');
            loginForm.classList.add('active');
            signupForm.classList.remove('active');
            loginError.textContent = '';
            signupError.textContent = '';
            signupSuccess.textContent = '';
        });

        signupTab.addEventListener('click', () => {
            signupTab.classList.add('active');
            loginTab.classList.remove('active');
            signupForm.classList.add('active');
            loginForm.classList.remove('active');
            loginError.textContent = '';
            signupError.textContent = '';
            signupSuccess.textContent = '';
        });

        switchToSignup.addEventListener('click', () => {
            signupTab.click();
        });

        switchToLogin.addEventListener('click', () => {
            loginTab.click();
        });

        loginBtn.addEventListener('click', () => {
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();
            
            if (!username || !password) {
                loginError.textContent = 'Please enter both username and password';
                return;
            }
            
            const result = userManager.login(username, password);
            
            if (result.success) {
                appState = result.user.appState;
                showMainApp(result.user);
            } else {
                loginError.textContent = result.message;
            }
        });

        signupBtn.addEventListener('click', () => {
            const username = signupUsername.value.trim();
            const email = signupEmail.value.trim();
            const password = signupPassword.value.trim();
            const confirm = signupConfirm.value.trim();
            
            // Validate inputs
            if (!username || !password) {
                signupError.textContent = 'Username and password are required';
                return;
            }
            
            if (password.length < 4) {
                signupError.textContent = 'Password must be at least 4 characters';
                return;
            }
            
            if (password !== confirm) {
                signupError.textContent = 'Passwords do not match';
                return;
            }
            
            const result = userManager.createUser(username, password, email);
            
            if (result.success) {
                signupError.textContent = '';
                signupSuccess.textContent = result.message;
                
                // Clear form
                signupUsername.value = '';
                signupEmail.value = '';
                signupPassword.value = '';
                signupConfirm.value = '';
                
                // Auto-switch to login tab after 2 seconds
                setTimeout(() => {
                    loginTab.click();
                    loginUsername.value = username;
                    loginPassword.value = password;
                }, 2000);
            } else {
                signupError.textContent = result.message;
                signupSuccess.textContent = '';
            }
        });

        // Logout button
        logoutBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                userManager.logout();
                showAuthScreen();
                
                // Clear login form
                loginUsername.value = '';
                loginPassword.value = '';
                loginError.textContent = '';
            }
        });

        // Allow pressing Enter to login/signup
        loginUsername.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginBtn.click();
        });
        
        loginPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginBtn.click();
        });
        
        signupUsername.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') signupBtn.click();
        });
        
        signupPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') signupBtn.click();
        });
        
        signupConfirm.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') signupBtn.click();
        });

        // App Event Listeners
        addTaskBtn.addEventListener('click', () => {
            addTaskModal.classList.add('active');
            taskInput.focus();
        });

        closeTaskModal.addEventListener('click', () => {
            addTaskModal.classList.remove('active');
            taskInput.value = '';
        });

        saveTaskBtn.addEventListener('click', () => {
            const taskText = taskInput.value.trim();
            const selectedCategory = document.querySelector('.category-badge.selected');
            
            if (!taskText) {
                alert('Please enter a task description.');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const newTask = {
                id: Date.now(),
                text: taskText,
                completed: false,
                category: selectedCategory ? selectedCategory.getAttribute('data-category') : 'productivity',
                date: today
            };
            
            appState.tasks.push(newTask);
            
            taskInput.value = '';
            addTaskModal.classList.remove('active');
            
            renderTasks();
            updateUI();
        });

        categoryBadges.addEventListener('click', (e) => {
            if (e.target.classList.contains('category-badge')) {
                document.querySelectorAll('.category-badge').forEach(badge => {
                    badge.classList.remove('selected');
                });
                e.target.classList.add('selected');
            }
        });

        suggestedTasksContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('suggested-task')) {
                taskInput.value = e.target.textContent;
            }
        });

        tasksList.addEventListener('click', (e) => {
            // Task checkbox
            if (e.target.classList.contains('task-checkbox')) {
                const taskId = parseInt(e.target.getAttribute('data-id'));
                const task = appState.tasks.find(t => t.id === taskId);
                
                if (task) {
                    task.completed = e.target.checked;
                    
                    // Update completed tasks count
                    const today = new Date().toISOString().split('T')[0];
                    const todayTasks = appState.tasks.filter(t => t.date === today);
                    appState.completedTasksToday = todayTasks.filter(t => t.completed).length;
                    
                    renderTasks();
                    updateUI();
                    
                    // Animation for task completion
                    if (task.completed) {
                        e.target.parentElement.style.transform = 'scale(1.05)';
                        setTimeout(() => {
                            e.target.parentElement.style.transform = '';
                        }, 300);
                    }
                }
            }
            
            // Edit task
            if (e.target.closest('.edit-task')) {
                const taskId = parseInt(e.target.closest('.edit-task').getAttribute('data-id'));
                const task = appState.tasks.find(t => t.id === taskId);
                
                if (task) {
                    const newText = prompt('Edit task:', task.text);
                    if (newText !== null && newText.trim()) {
                        task.text = newText.trim();
                        renderTasks();
                        updateUI();
                    }
                }
            }
            
            // Delete task
            if (e.target.closest('.delete-task')) {
                const taskId = parseInt(e.target.closest('.delete-task').getAttribute('data-id'));
                if (confirm('Are you sure you want to delete this task?')) {
                    appState.tasks = appState.tasks.filter(t => t.id !== taskId);
                    
                    // Update completed tasks count
                    const today = new Date().toISOString().split('T')[0];
                    const todayTasks = appState.tasks.filter(t => t.date === today);
                    appState.completedTasksToday = todayTasks.filter(t => t.completed).length;
                    
                    renderTasks();
                    updateUI();
                }
            }
        });

        moodOptionsContainer.addEventListener('click', (e) => {
            const moodOption = e.target.closest('.mood-option');
            if (moodOption) {
                const mood = moodOption.getAttribute('data-mood');
                appState.currentMood = mood;
                
                document.querySelectorAll('.mood-option').forEach(option => {
                    option.classList.remove('selected');
                });
                moodOption.classList.add('selected');
                
                // Update mood trend message
                const positiveMoods = ['Happy', 'Calm'];
                const neutralMoods = ['Neutral'];
                
                if (positiveMoods.includes(mood)) {
                    moodTrend.textContent = ' Positive mood today! Keep shining!';
                    moodTrend.style.color = '#1dd1a1';
                } else if (neutralMoods.includes(mood)) {
                    moodTrend.textContent = ' Balanced day today. That\'s perfectly fine!';
                    moodTrend.style.color = '#8395a7';
                } else {
                    moodTrend.textContent = ' Taking it easy today. Be kind to yourself.';
                    moodTrend.style.color = '#ff9f43';
                }
                
                saveState();
            }
        });

        saveJournalBtn.addEventListener('click', saveJournalEntry);

        viewJournalBtn.addEventListener('click', () => {
            renderJournalHistory();
            journalModal.classList.add('active');
        });

        closeJournalModal.addEventListener('click', () => {
            journalModal.classList.remove('active');
        });

        closeFlowerModal.addEventListener('click', () => {
            flowerModal.classList.remove('active');
        });

        // Garden flower click
        gardenGrid.addEventListener('click', (e) => {
            const flowerElement = e.target.closest('.garden-flower');
            if (flowerElement) {
                const flowerId = parseInt(flowerElement.getAttribute('data-flower-id'));
                showFlowerDetails(flowerId);
            }
        });

        completeDayBtn.addEventListener('click', completeDay);

        newDayBtn.addEventListener('click', () => {
            if (appState.completedTasksToday > 0) {
                if (!confirm('Starting a new day will reset today\'s progress. Are you sure?')) {
                    return;
                }
            }
            
            // Reset today's progress
            const today = new Date().toISOString().split('T')[0];
            appState.tasks = appState.tasks.filter(task => task.date !== today);
            appState.completedTasksToday = 0;
            appState.currentMood = null;
            
            // Update UI
            renderTasks();
            renderMoodOptions();
            updateUI();
            
            // Reset mood trend
            moodTrend.textContent = 'Select your mood for today';
            moodTrend.style.color = '';
            
            alert('New day started! Your progress has been reset.');
        });

        // Breathing exercise controls
        startBreathingBtn.addEventListener('click', startBreathingExercise);
        resetBreathingBtn.addEventListener('click', resetBreathingExercise);

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === addTaskModal) addTaskModal.classList.remove('active');
            if (e.target === journalModal) journalModal.classList.remove('active');
            if (e.target === flowerModal) flowerModal.classList.remove('active');
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Add some CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            
            @keyframes float {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-10px); }
            }
            
            .task-item.completed {
                animation: pulse 0.5s ease;
            }
            
            .flower {
                animation: float 3s ease-in-out infinite;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
